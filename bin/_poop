#!/bin/bash

function do_ {
  true
}

function directory {
  _poop_name="$1"; shift
  _poop_resource="directory"
}

function do_directory {
  # since install -d recursively creates directories, check for intermediate
  # directories manually when recursion is not desired
  if [[ -z "$_poop_recursive" ]]; then
    local dname="$(dirname "${_poop_path:-${_poop_name}}")"
    if [[ ! -d "$dname" ]]; then
      logger_fatal "while creating ${_poop_path:-${_poop_name}}, $dname is not a directory"
      exit 1
    fi
  fi

  install -v -d $(install_options)"${_poop_path:-${_poop_name}}"
}

function mode {
  _poop_mode="$1"; shift
}

function owner {
  _poop_owner="$1"; shift
}

function group {
  _poop_group="$1"; shift
}

function path {
  _poop_path="$1"; shift
}

function recursive {
  _poop_recursive="$1"; shift
}

function end {
  eval "do_${_poop_resource}"

  _poop_name=
  _poop_mode=
  _poop_owner=
  _poop_group=
  _poop_path=
  _poop_recursive=
}

function install_options {
  if [[ -n "$_poop_mode" ]]; then
    echo -n "-m $_poop_mode "
  fi

  if [[ -n "$_poop_owner" ]]; then
    echo -n "-o $_poop_owner"
  fi

  if [[ -n "$_poop_group" ]]; then
    echo -n "-g $_poop_group"
  fi
}

_poop_resource=
end

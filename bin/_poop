#!/bin/bash

function do_ {
  true
}

function end_ {
  true
}

_last_end="end_"

function attr_accessor {
  local attr="$1"; shift
  local attrdef="${1:-}"
  local dollar='$'

  eval "_poop_${attr}="
  eval "function ${attr} { _poop_${attr}="${dollar}1"; shift; }"
  eval "function end_${attr} { _poop_${attr}=; ${_last_end}=${attrdef}; }"
  _last_end="end_${attr}"
}

function end {
  eval "do_${_poop_resource}"
  eval "${_last_end}"

  _poop_ignore_failure=false
  _poop_retries=0
  _poop_retry_delay=2
}

function install_options {
  if [[ -n "$_poop_mode" ]]; then
    echo -n "-m $_poop_mode "
  fi

  if [[ -n "$_poop_owner" ]]; then
    echo -n "-o $_poop_owner"
  fi

  if [[ -n "$_poop_group" ]]; then
    echo -n "-g $_poop_group"
  fi
}

function recipe {
  local nm_recipe="$1"; shift
  set --
  source "$nm_recipe"
}

attr_accessor resource
attr_accessor ignore_failure false
attr_accessor provider 
attr_accessor retries 0
attr_accessor retry_delay 2
attr_accessor supports
attr_accessor action 
attr_accessor recursive
attr_accessor mode 
attr_accessor owner 
attr_accessor group
attr_accessor path

end

require 'poop/directory'
